<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel de Funcionários</title>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
    />
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="assets/menu.css" />
</head>
<body class="bg-light">
<div id="navbarContainer"></div>

<div class="container py-5">
    <h2 class="mb-4 text-center">Painel Administrativo - Funcionários</h2>

    <form id="formFuncionario" class="row g-3 mb-4">
        <input type="hidden" id="funcionarioId" />

        <div class="col-md-4">
            <label for="nome" class="form-label">Nome</label>
            <input type="text" class="form-control" id="nome" required />
        </div>

        <div class="col-md-4">
            <label for="cpf" class="form-label">CPF</label>
            <input type="text" class="form-control" id="cpf" required />
        </div>

        <div class="col-md-4">
            <label for="cargo" class="form-label">Cargo</label>
            <input type="text" class="form-control" id="cargo" required />
        </div>

        <div class="col-md-12 text-end">
            <button type="submit" class="btn btn-primary">
                Salvar Funcionário
            </button>
        </div>
    </form>

    <!-- Tabela de Funcionários -->
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
        <tr>
            <th>Nome</th>
            <th>CPF</th>
            <th>Cargo</th>
            <th>Ações</th>
        </tr>
        </thead>
        <tbody id="tabelaFuncionarios"></tbody>
    </table>

    <!-- Modal de confirmação de exclusão -->
    <div
            class="modal fade"
            id="confirmDeleteModal"
            tabindex="-1"
            aria-labelledby="confirmDeleteLabel"
            aria-hidden="true"
    >
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmDeleteLabel">
                        Confirmar exclusão
                    </h5>
                    <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Fechar"
                    ></button>
                </div>
                <div class="modal-body">
                    Tem certeza que deseja excluir este funcionário?
                </div>
                <div class="modal-footer">
                    <button
                            type="button"
                            class="btn btn-secondary btn-sm"
                            data-bs-dismiss="modal"
                    >
                        Cancelar
                    </button>
                    <button
                            type="button"
                            id="confirmDeleteBtn"
                            class="btn btn-danger btn-sm"
                    >
                        Excluir
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const form = document.getElementById("formFuncionario");
    const tabela = document.getElementById("tabelaFuncionarios");

    function carregarFuncionarios() {
      const funcionarios = JSON.parse(
        localStorage.getItem("funcionarios") || "[]"
      );
      tabela.innerHTML = "";
      funcionarios.forEach((f, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${f.nome}</td>
          <td>${f.cpf}</td>
          <td>${f.cargo}</td>
          <td>
            <button class="btn btn-sm btn-outline-warning me-2" onclick="editarFuncionario(${index})" title="Editar">
              <i class="bi bi-pencil-fill"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="confirmarExclusao(${index})" title="Excluir">
              <i class="bi bi-trash-fill"></i>
            </button>
          </td>
        `;
        tabela.appendChild(row);
      });
    }

    function editarFuncionario(index) {
      const funcionarios = JSON.parse(
        localStorage.getItem("funcionarios") || "[]"
      );
      const f = funcionarios[index];
      document.getElementById("funcionarioId").value = index;
      document.getElementById("nome").value = f.nome;
      document.getElementById("cpf").value = f.cpf;
      document.getElementById("cargo").value = f.cargo;
    }

    function excluirFuncionario(index) {
      const funcionarios = JSON.parse(
        localStorage.getItem("funcionarios") || "[]"
      );
      funcionarios.splice(index, 1);
      localStorage.setItem("funcionarios", JSON.stringify(funcionarios));
      carregarFuncionarios();
    }

    let _deleteIndex = null;

    function confirmarExclusao(index) {
      _deleteIndex = index;
      const modalEl = document.getElementById("confirmDeleteModal");
      const modal = new bootstrap.Modal(modalEl);
      modal.show();
    }

    document.addEventListener("DOMContentLoaded", function () {
      const confirmBtn = document.getElementById("confirmDeleteBtn");
      if (confirmBtn) {
        confirmBtn.addEventListener("click", function () {
          if (_deleteIndex !== null) {
            excluirFuncionario(_deleteIndex);
            _deleteIndex = null;
            const modalEl = document.getElementById("confirmDeleteModal");
            const modal = bootstrap.Modal.getInstance(modalEl);
            if (modal) modal.hide();
          }
        });
      }
    });

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const funcionarios = JSON.parse(
        localStorage.getItem("funcionarios") || "[]"
      );

      const id = document.getElementById("funcionarioId").value;

      const novoFuncionario = {
        nome: document.getElementById("nome").value,
        cpf: document.getElementById("cpf").value,
        cargo: document.getElementById("cargo").value,
      };

      if (id === "") {
        funcionarios.push(novoFuncionario);
      } else {
        funcionarios[id] = novoFuncionario;
      }

      localStorage.setItem("funcionarios", JSON.stringify(funcionarios));
      form.reset();
      document.getElementById("funcionarioId").value = "";
      carregarFuncionarios();
    });

    document.addEventListener("DOMContentLoaded", carregarFuncionarios);
</script>
</body>

<script>
    fetch("assets/components/navbar.html")
      .then((res) => res.text())
      .then((html) => {
        document.getElementById("navbarContainer").innerHTML = html;
        document.getElementById("logoNav").src = "assets/images/supplier (1).png";
      });
</script>
</html>
