<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Painel de Produtos</title>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
    />
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="assets/menu.css" />
</head>
<body class="bg-light">
<div id="navbarContainer"></div>

<div class="container py-5">
    <h2 class="mb-4 text-center">Painel Administrativo - Produtos</h2>

    <form id="formProduto" class="row g-3 mb-4">
        <input type="hidden" id="produtoId" />

        <div class="col-md-4">
            <label for="nome" class="form-label">Nome do Produto</label>
            <input type="text" class="form-control" id="nome" required />
        </div>

        <div class="col-md-4">
            <label for="descricao" class="form-label">Descrição</label>
            <input type="text" class="form-control" id="descricao" required />
        </div>

        <div class="col-md-2">
            <label for="preco" class="form-label">Preço (R$)</label>
            <input
                    type="number"
                    class="form-control"
                    id="preco"
                    step="0.01"
                    min="0"
                    required
            />
        </div>

        <div class="col-md-2">
            <label for="validade" class="form-label">Validade</label>
            <input type="date" class="form-control" id="validade" required />
        </div>

        <div class="col-md-3">
            <label for="quantidade" class="form-label">Quantidade</label>
            <input
                    type="number"
                    class="form-control"
                    id="quantidade"
                    min="0"
                    required
            />
        </div>

        <div class="col-md-9 text-end">
            <button type="submit" class="btn btn-primary">Salvar Produto</button>
        </div>
    </form>

    <!-- Tabela -->
    <table class="table table-bordered table-striped">
        <thead class="table-dark">
        <tr>
            <th>Nome</th>
            <th>Descrição</th>
            <th>Preço</th>
            <th>Validade</th>
            <th>Quantidade</th>
            <th>Ações</th>
        </tr>
        </thead>
        <tbody id="tabelaProdutos"></tbody>
    </table>

    <!-- Modal -->
    <div
            class="modal fade"
            id="confirmDeleteModal"
            tabindex="-1"
            aria-labelledby="confirmDeleteLabel"
            aria-hidden="true"
    >
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmDeleteLabel">
                        Confirmar exclusão
                    </h5>
                    <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Fechar"
                    ></button>
                </div>
                <div class="modal-body">
                    Tem certeza que deseja excluir este produto?
                </div>
                <div class="modal-footer">
                    <button
                            type="button"
                            class="btn btn-secondary btn-sm"
                            data-bs-dismiss="modal"
                    >
                        Cancelar
                    </button>
                    <button
                            type="button"
                            id="confirmDeleteBtn"
                            class="btn btn-danger btn-sm"
                    >
                        Excluir
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const form = document.getElementById("formProduto");
    const tabela = document.getElementById("tabelaProdutos");

    function carregarProdutos() {
      const produtos = JSON.parse(localStorage.getItem("produtos") || "[]");
      tabela.innerHTML = "";

      produtos.forEach((p, index) => {
        const row = document.createElement("tr");

        const precoFormatado = new Intl.NumberFormat("pt-BR", {
          style: "currency",
          currency: "BRL",
        }).format(p.preco || 0);

        const validadeFormatada = p.validade
          ? new Date(p.validade).toLocaleDateString("pt-BR")
          : "";

        row.innerHTML = `
          <td>${p.nome}</td>
          <td>${p.descricao}</td>
          <td>${precoFormatado}</td>
          <td>${validadeFormatada}</td>
          <td>${p.quantidade}</td>
          <td>
            <button class="btn btn-sm btn-outline-warning me-2" onclick="editarProduto(${index})">
              <i class="bi bi-pencil-fill"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="confirmarExclusao(${index})">
              <i class="bi bi-trash-fill"></i>
            </button>
          </td>
        `;
        tabela.appendChild(row);
      });
    }

    function editarProduto(index) {
      const produtos = JSON.parse(localStorage.getItem("produtos") || "[]");
      const p = produtos[index];

      document.getElementById("produtoId").value = index;
      document.getElementById("nome").value = p.nome;
      document.getElementById("descricao").value = p.descricao;
      document.getElementById("preco").value = p.preco;
      document.getElementById("validade").value = p.validade;
      document.getElementById("quantidade").value = p.quantidade;
    }

    function excluirProduto(index) {
      const produtos = JSON.parse(localStorage.getItem("produtos") || "[]");
      produtos.splice(index, 1);
      localStorage.setItem("produtos", JSON.stringify(produtos));
      carregarProdutos();
    }

    let _deleteIndex = null;

    function confirmarExclusao(index) {
      _deleteIndex = index;
      const modalEl = document.getElementById("confirmDeleteModal");
      const modal = new bootstrap.Modal(modalEl);
      modal.show();
    }

    document.addEventListener("DOMContentLoaded", function () {
      const confirmBtn = document.getElementById("confirmDeleteBtn");
      if (confirmBtn) {
        confirmBtn.addEventListener("click", function () {
          if (_deleteIndex !== null) {
            excluirProduto(_deleteIndex);
            _deleteIndex = null;
            const modalEl = document.getElementById("confirmDeleteModal");
            const modal = bootstrap.Modal.getInstance(modalEl);
            if (modal) modal.hide();
          }
        });
      }
    });

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const produtos = JSON.parse(localStorage.getItem("produtos") || "[]");
      const id = document.getElementById("produtoId").value;

      const novoProduto = {
        nome: document.getElementById("nome").value,
        descricao: document.getElementById("descricao").value,
        preco: parseFloat(document.getElementById("preco").value) || 0,
        validade: document.getElementById("validade").value,
        quantidade:
          parseInt(document.getElementById("quantidade").value) || 0,
      };

      if (id === "") {
        produtos.push(novoProduto);
      } else {
        produtos[id] = novoProduto;
      }

      localStorage.setItem("produtos", JSON.stringify(produtos));
      form.reset();
      document.getElementById("produtoId").value = "";
      carregarProdutos();
    });

    document.addEventListener("DOMContentLoaded", carregarProdutos);
</script>
</body>

<script>
    fetch("assets/components/navbar.html")
      .then((res) => res.text())
      .then((html) => {
        document.getElementById("navbarContainer").innerHTML = html;
        document.getElementById("logoNav").src = "assets/images/products.png";
      });
</script>
</html>
